<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home – undefined</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.css">
    <link rel="canonical" href="/2/">
    <link rel="alternate" type="application/rss+xml" title="undefined" href="/feed.xml">

    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

</head>
<body>

  <section class="hero is-medium is-primary is-bold">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        Live Blog
      </h1>
      <h2 class="subtitle">
        Primary bold subtitle
      </h2>
    </div>
  </div>
</section>
  <div class="container">
    <div class="columns is-centered">
  <div class="column is-two-thirds-desktop posts-container">

    
      <div class="box">
  <article class="media">
    <div class="media-left">
      <figure class="image is-64x64">
        <img src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
      </figure>
    </div>
    <div class="media-content">
      <div class="content">
        <h3>post one</h3>
        <p>This is a post body</p>

      </div>
      <nav class="level is-mobile">
        <div class="level-left">
          <a class="level-item" aria-label="reply">
            <span class="icon is-small">
              <i class="fas fa-reply" aria-hidden="true"></i>
            </span>
          </a>
          <a class="level-item" aria-label="retweet">
            <span class="icon is-small">
              <i class="fas fa-retweet" aria-hidden="true"></i>
            </span>
          </a>
          <a class="level-item" aria-label="like">
            <span class="icon is-small">
              <i class="fas fa-heart" aria-hidden="true"></i>
            </span>
          </a>
        </div>
      </nav>
    </div>
  </article>
</div>
    

    </div>
  </div>

  <h2 id="pagination-title">Pages</h2>
  <nav aria-labelledby="pagination-title" class="pagination is-rounded" role="navigation" aria-label="pagination">

    <ul class="pagination-list">
        <li><a class="pagination-link " aria-label="Page 1" href="/">1</a></li>
        <li><a class="pagination-link " aria-label="Page 2" href="/1/">2</a></li>
        <li><a class="pagination-link is-current" aria-label="Page 3" href="/2/" aria-current="page">3</a></li>
    </ul>
    <a class="pagination-previous" href="/1/">«</a>
    <div class="pagination-next">»</div>

  </nav>

</div>
  </div>
  <footer class="footer">
  <div class="content has-text-centered">
    <p>
      <strong>LiveBlogger</strong> by <a href="https://">John Puddephatt</a>. The source code is licensed
      <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content
      is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.
    </p>
  </div>
</footer>
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }

      var currentCount = 13;
      const postsContainer= document.querySelector('.posts-container');

      var request = new XMLHttpRequest();

      request.onload = function() {
        if (this.status >= 200 && this.status < 400) {
          // Success!
          var data = JSON.parse(this.response);
          if (data.count > currentCount) {
            var newPostCount = data.count - currentCount;
            for (var i = newPostCount; i > 0; i--) {
              getNewPost(data.count - i + 1);
            }
            currentCount = data.count;
          }
        } else {
          // We reached our target server, but it returned an error
          console.log('reached server. got error');
        }
      };

      request.onerror = function() {
        console.log('Connection error');
      };

      setInterval(()=>{
        request.open('GET', '/count.json', true);
        request.send();
      }, 3000)

      const getNewPost = (id) => {
        var request = new XMLHttpRequest();
        request.onload = function() {
          if (this.status >= 200 && this.status < 400) {
            // Success!
            postsContainer.insertAdjacentHTML('afterbegin', this.response);
          } else {
             // We reached our target server, but it returned an error
             console.log('reached server. got error');
           }
         }
         request.open('GET', `/posts/${id}.html`, true);
         request.send();
         request.onerror = function() {
           console.log('Connection error');
         };
      }
    </script>

  </body>
</html>
